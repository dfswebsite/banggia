"use strict";angular.module("superstockApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ui.grid","ui.grid.pinning","firebase.auth","firebase.ref","ui.slider"]),angular.module("superstockApp").factory("draw",["$firebaseArray",function(a){var b=function(b,c,d,e,f){var g=a(b),h=[];g.$watch(function(){if(0!=g.length){var a=g[g.length-1],b={};c.idLabel&&(b[c.idLabel]=a.$id);var e=a.$value.split("|");for(var f in c.labelList)c.labelList[f].format.indexOf("percent")>-1?b[c.labelList[f].fieldName]=Math.ceil(1e4*e[f])/100:c.labelList[f].format.indexOf("bigNum")>-1||c.labelList[f].format.indexOf("number")>-1?b[c.labelList[f].fieldName]=parseFloat(e[f]):b[c.labelList[f].fieldName]=e[f];d(b),h.push(b)}}),g.$loaded(function(){e(g),console.log("loaded"),b.on("child_added",function(a,b){console.log("add");var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)c.labelList[g].format.indexOf("percent")>-1?d[c.labelList[g].fieldName]=Math.ceil(1e4*e[g])/100:c.labelList[g].format.indexOf("bigNum")>-1||c.labelList[g].format.indexOf("number")>-1?d[c.labelList[g].fieldName]=parseFloat(e[g]):d[c.labelList[g].fieldName]=e[g];f.added(d,a,b)}),b.on("child_changed",function(a,b){console.log("change");var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)d[c.labelList[g].fieldName]=e[g];f.changed(d,a,b)}),b.on("child_removed",function(a){console.log("remove"),f.removed(a)})})};return{drawGrid:b}}]),angular.module("superstockApp").controller("MainCtrl",["$rootScope","$scope","$firebaseArray","$firebaseObject","Ref","draw",function(a,b,c,d,e,f){a.link="main";var g=parseFloat($(".header").css("height"))+parseFloat($(".footer").css("height")),h=$(document).height(),i=30;b.gridOption={minRowsToShow:Math.floor((h-g-50-i)/30),data:[]},console.log(b.gridOption);var j=d(e.child("longterm_titles")),k=d(e.child("longterm_headers"));k.$loaded(function(){j.$loaded(function(){var a=j.data.split("|"),c=k.data.split("|"),d=[100,200,200,130,200,150,150],g=[],h={idLabel:"Mã",labelList:[]};for(var i in a){a[i]=a[i].replace("\n",""),h.labelList.push({fieldName:c[i],format:""});var l=null,m={field:c[i],width:d[i],displayName:a[i],cellClass:l};g.push(m)}g[0].pinnedLeft=!0,b.gridOption.columnDefs=g,console.log(g),f.drawGrid(e.child("longterm"),h,function(a){b.gridOption.data.push(a)},function(a){},{added:function(a,c,d){var e=c.key;for(var f in b.gridOption.data)if(b.gridOption.data[f]["Mã"]==e)return void(b.gridOption.data[f]=a);b.gridOption.data.push(a)},changed:function(a,c,d){var e=c.key;for(var f in b.gridOption.data)if(b.gridOption.data[f]["Mã"]==e){b.gridOption.data[f]=a;break}},removed:function(a){var c=a.key;for(var d in b.gridOption.data)if(b.gridOption.data[d]["Mã"]==c){b.gridOption.data.splice(d,1);break}}})})})}]),angular.module("superstockApp").controller("FullStockCtrl",["$rootScope","$scope","$firebaseArray","$firebaseObject","Ref","draw","uiGridConstants",function(a,b,c,d,e,f,g){a.link="full",b.uiGridConstants=g;var h=parseFloat($(".header").css("height"))+parseFloat($(".footer").css("height")),i=$(document).height(),j=30;b.gridOption={flatEntityAccess:!0,fastWatch:!0,enableFiltering:!0,minRowsToShow:Math.floor((i-h-50-j)/30),data:[]},console.log(b.gridOption);var k=1e9,l=d(e.child("superstock_titles")),m=d(e.child("superstock_fields")),n=d(e.child("superstock_format"));m.$loaded(function(){l.$loaded(function(){n.$loaded(function(){var c=l.data.split("|"),d=m.data.split("|"),h=n.data.split("|");console.log(h),console.log(c);var i=[50,200,130,130,120,150,150,110,70,230,220,200,120,170,80,130,120,120,100,100,100,70,80,90,130,150,250,60,100,90,90,150],j=[],o={idLabel:"Mã",labelList:[]};for(var p in c){c[p]=c[p].replace("\n",""),o.labelList.push({fieldName:d[p],format:h[p]});var q=null,r=null;h[p].indexOf("bigNum")>-1||h[p].indexOf("number")>-1?(q="number",r="ui-cell-align-right"):r=h[p].indexOf("percent")>-1?"ui-cell-align-right":"ui-cell-align-left";var s={field:d[p],width:i[p],displayName:c[p],cellClass:r};if(q&&(s.cellFilter=q),h[p].indexOf("percent")>-1&&(s.cellClass+=" percent"),""!=h[p]){var t=h[p].split(":"),u=[{condition:g.filter.GREATER_THAN,placeholder:"greater than",term:"bigNum"==t[0]?parseFloat(t[1])*k:parseFloat(t[1]),min:"bigNum"==t[0]?parseFloat(t[1])*k:parseFloat(t[1]),bigNum:"bigNum"==t[0]?!0:!1},{condition:g.filter.LESS_THAN,placeholder:"less than",term:"bigNum"==t[0]?parseFloat(t[3])*k:parseFloat(t[3]),max:"bigNum"==t[0]?parseFloat(t[3])*k:parseFloat(t[3])}];s.filters=u}j.push(s)}j[0].pinnedLeft=!0,a.filters=j,a.subTerm=[];for(var p in a.filters)a.filters[p].filters&&a.filters[p].filters[0].bigNum&&(a.subTerm[p]=a.filters[p].filters[0].term/k);a.$watch("filters[2]",function(){console.log("change")}),console.log(a.subTerm),console.log(a.filters),b.gridOption.columnDefs=j,f.drawGrid(e.child("superstock"),o,function(a){b.gridOption.data.push(a)},function(a){},{added:function(a,c,d){var e=c.key;for(var f in b.gridOption.data)if(b.gridOption.data[f]["Mã"]==e)return a.A100=a["Mã"],void(b.gridOption.data[f]=a);b.gridOption.data.push(a)},changed:function(a,c,d){var e=c.key;for(var f in b.gridOption.data)if(b.gridOption.data[f]["Mã"]==e){b.gridOption.data[f]=a;break}},removed:function(a){var c=a.key;for(var d in b.gridOption.data)if(b.gridOption.data[d]["Mã"]==c){b.gridOption.data.splice(d,1);break}}})})})})}]),angular.module("superstockApp").controller("MenuCtrl",["$rootScope","$scope",function(a,b){a.link="",b.filterShow=function(a){a.preventDefault(),a.stopPropagation(),setTimeout(function(){$("#wrapper").toggleClass("toggled"),console.log("silder")},200)}}]),angular.module("superstockApp").controller("FilterCtrl",["$rootScope","$scope",function(a,b){b.demoVals={sliderExample3:14},a.abc=1e4,a.filters=[],a.subTerm=[]}]),angular.module("superstockApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),angular.module("firebase.auth",[]).constant("SIMPLE_LOGIN_PROVIDERS",["password","facebook"]).constant("loginRedirectPath","/login").factory("auth",["$firebaseAuth",function(a){return a()}]),angular.module("firebase.ref",["firebase"]).factory("Ref",function(){return firebase.database().ref()}),angular.module("superstockApp").controller("LoginCtrl",["$scope","auth","$location",function(a,b,c){function d(a){var b=(rootRef.child("users").child(a.uid),$q.defer());return ref.set({email:email,name:e(email)},function(a){$timeout(function(){a?b.reject(a):b.resolve(ref)})}),b.promise}function e(a){return f(a.substr(0,a.indexOf("@"))||"")}function f(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function g(){c.path("/account")}function h(b){a.err=b}a.loginBtn=!0,a.logoutBtn=!0,b.$onAuthStateChanged(function(b){b&&(console.log(" logged: "+b.uid),a.logoutBtn=!0,a.loginBtn=!1,c.path("/account"))}),a.oauthLogin=function(a){b.$signInWithPopup(a).then(function(a){console.log("logged"),g()})["catch"](function(a){console.log("login error"),h(a)})},a.anonymousLogin=function(){b.$signInAnonymously().then(function(a){console.log("logged ",a.uid)})["catch"](function(a){console.log("login error ",a)})},a.passwordLogin=function(a,c){b.$signInWithEmailAndPassword(a,c).then(function(a){g(),console.log("logged")})["catch"](function(a){h(a),console.log("error: "+a)})},a.createAccount=function(c,e,f){a.err=null,e?e!==f?a.err="Passwords do not match":b.$createUserWithEmailAndPassword(c,e).then(function(a){return console.log("User "+a.uid+" created successfully"),a}).then(function(a){console.log("Logged user: ",a.uid),d(),g()})["catch"](function(a){console.error("Error: ",a)}):a.err="Please enter a password"}}]),angular.module("superstockApp").controller("AccountCtrl",["$scope","auth","currentAuth",function(a,b,c,d){function e(a){console.log("Error: ",a)}a.user={uid:c.uid,name:c.displayName,photo:c.photoURL,email:c.email},a.authInfo=c,a.changePassword=function(c,d,f){a.err=null,c&&d?d!==f?e("Passwords do not match"):b.$updatePassword(d).then(function(){console.log("Password changed")},e):e("Please enter all fields")},a.changeEmail=function(a){b.$updateEmail(a).then(function(){console.log("email changed successfully")})["catch"](function(a){console.log("Error: ",a)})},a.logout=function(){b.$signOut()},a.updateProfile=function(a,b){firebase.auth().currentUser.updateProfile({displayName:a,photoURL:b}).then(function(){console.log("updated")})["catch"](function(a){console.log("error ",a)})}}]),angular.module("superstockApp").directive("ngShowAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("ngHideAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("categoryHeader",function(){function a(a){console.log(a.gridOptions.columnDefs),a.headerRowHeight=30,a.catHeaderRowHeight=a.headerRowHeight+"px",a.categories=[];var b="",c=0,d=0;cols=a.gridOptions.columnDefs;for(var e=0;e<cols.length;e++){c+=Number(cols[e].width);var f="undefined"==typeof cols[e].categoryDisplayName?" ":cols[e].categoryDisplayName;f!==b&&(a.categories.push({displayName:b,width:c-Number(cols[e].width),widthPx:c-Number(cols[e].width)+"px",left:d,leftPx:d+"px"}),d+=c-Number(cols[e].width),c=Number(cols[e].width),b=f)}c>0&&a.categories.push({displayName:b,width:c,widthPx:c+"px",left:d,leftPx:d+"px"})}return{templateUrl:"scripts/directives/templates/category_header.html",link:a}}),angular.module("superstockApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/full",{templateUrl:"views/full-stock.html",controller:"FullStockCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl",resolve:{currentAuth:["auth",function(a){return a.$requireSignIn()}]}}).when("/chat",{templateUrl:"views/chat.html",controller:"Chat",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","loginRedirectPath",function(a,b,c,d,e,f,g){a.$on("$routeChangeError",function(a,d,e,f){"AUTH_REQUIRED"===f&&b.path(c)})}]);