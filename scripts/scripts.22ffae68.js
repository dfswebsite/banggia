"use strict";angular.module("superstockApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ui.grid","ui.grid.pinning","firebase.auth","firebase.ref","ui.slider","btorfs.multiselect","uiSwitch"]),$(document).on("click",".ui-grid-row",function(){var a=$(this),b=a.find(".click-row").length;$(".ui-grid-row").find(".ui-grid-cell").removeClass("click-row"),b>0?a.children().children().removeClass("click-row"):a.children().children().addClass("click-row")}),angular.module("superstockApp").factory("draw",["$firebaseArray",function(a){var b=function(b,c,d,e,f){var g=a(b),h=[],i=!0;g.$watch(function(a){if(0!=i&&0!=g.length){var b=g[g.length-1],e={};c.idLabel&&(e[c.idLabel]=b.$id);var f=b.$value.split("|");for(var j in c.labelList)c.labelList[j].format.indexOf("percent")>-1?e[c.labelList[j].fieldName]=Math.ceil(1e4*f[j])/100:c.labelList[j].format.indexOf("bigNum")>-1||c.labelList[j].format.indexOf("number")>-1?e[c.labelList[j].fieldName]=parseFloat(f[j]):e[c.labelList[j].fieldName]=f[j];d(e),h.push(e)}}),g.$loaded(function(){i=!1,e(g),console.log("loaded"),b.on("child_added",function(a,b){console.log("add");var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)c.labelList[g].format.indexOf("percent")>-1?d[c.labelList[g].fieldName]=Math.ceil(1e4*e[g])/100:c.labelList[g].format.indexOf("bigNum")>-1||c.labelList[g].format.indexOf("number")>-1?d[c.labelList[g].fieldName]=parseFloat(e[g]):d[c.labelList[g].fieldName]=e[g];f.added(d,a,b)}),b.on("child_changed",function(a,b){console.log("change");var d={};c.idLabel&&(d[c.idLabel]=a.key);var e=a.val().split("|");for(var g in c.labelList)c.labelList[g].format.indexOf("percent")>-1?d[c.labelList[g].fieldName]=Math.ceil(1e4*e[g])/100:c.labelList[g].format.indexOf("bigNum")>-1||c.labelList[g].format.indexOf("number")>-1?d[c.labelList[g].fieldName]=parseFloat(e[g]):d[c.labelList[g].fieldName]=e[g];f.changed(d,a,b)}),b.on("child_removed",function(a){console.log("remove"),f.removed(a)})})};return{drawGrid:b}}]),angular.module("superstockApp").factory("utils",function(){return{getCellTemplate:function(a,b){switch(a){case"priceChange":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 0, 'grid-cell-green': COL_FIELD >= 0}\">{{COL_FIELD | number:2}}</div>";case"EPS":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 1000, 'grid-cell-green': COL_FIELD > 1000}\">{{COL_FIELD | number:2}}</div>";case"revenueChange":case"EPSChange":case"profitChange":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 0, 'grid-cell-green': COL_FIELD > 0}\">{{COL_FIELD | number:2}}</div>";case"point":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 5, 'grid-cell-green': COL_FIELD >= 5, 'grid-cell-purple': COL_FIELD >= 7}\">{{COL_FIELD | number:2}}</div>";case"roe":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 10, 'grid-cell-green': COL_FIELD > 10 }\">{{COL_FIELD | number:2}}</div>";case"fxEffect":case"cashFlow":return"<div title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 0, 'grid-cell-green': COL_FIELD > 0 }\">{{COL_FIELD | number:2}}</div>";default:return"number"==b||"bigNum"==b?'<div title="{{COL_FIELD}}" class="ui-grid-cell-contents">{{COL_FIELD | number:2}}</div>':'<div title="{{COL_FIELD}}" class="ui-grid-cell-contents">{{COL_FIELD}}</div>'}},getCellTemplateSummary:function(a,b){switch(a){case"symbol":return"<div class=\"chart-pointer\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true,                        'grid-cell-purple': grid.appScope.colorCanslim(row,'purple'),                         'grid-cell-green': grid.appScope.colorCanslim(row,'green'),                         'grid-cell-fill': grid.appScope.fillCanslim(row)}\">{{COL_FIELD}}                        <img class='chart-icon' src='./images/icon-graph.png' ng-click=\"grid.appScope.symbolClick(row,col)\"/></div>";case"totalValue":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true,                         'grid-cell-purple': COL_FIELD >= 5e9, 'grid-cell-fill': COL_FIELD >= 5e9}\">{{COL_FIELD | number:2}}</div>";case"EPS":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD < 1000, 'grid-cell-green': COL_FIELD > 1000, 'grid-cell-fill grid-cell-purple': COL_FIELD >= 3000}\">{{COL_FIELD | number:2}}</div>";case"newPoint":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-red': COL_FIELD <= 4, 'grid-cell-green': COL_FIELD >= 5, 'grid-cell-fill grid-cell-purple': COL_FIELD >= 7}\">{{COL_FIELD | number:2}}</div>";case"Canslim":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-purple': COL_FIELD, 'grid-cell-fill': COL_FIELD }\">{{COL_FIELD}}</div>";case"pricePeak":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true,                         'grid-cell-purple': COL_FIELD && 'cao nhất 30 phiên' == COL_FIELD.trim().toLowerCase(),                         'grid-cell-fill': COL_FIELD && 'cao nhất 30 phiên' == COL_FIELD.trim().toLowerCase()}\">{{COL_FIELD}}</div>";case"signal1":case"signal2":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-class=\"{'ui-grid-cell-contents': true, 'grid-cell-purple': COL_FIELD, 'grid-cell-fill': COL_FIELD}\">{{COL_FIELD}}</div>";case"chart":case"symbol2":return'<div class="ui-grid-cell-'+a+"\" title=\"{{COL_FIELD}}\" ng-click=\"grid.appScope.symbolClick(row,col)\" ng-class=\"{'ui-grid-cell-contents': true,                        'grid-cell-purple': grid.appScope.colorCanslim(row,'purple'),                         'grid-cell-green': grid.appScope.colorCanslim(row,'green'),                         'grid-cell-fill': grid.appScope.fillCanslim(row)}\">{{grid.appScope.showSymbolHasSignal(row, COL_FIELD)}}</div>";default:return"number"==b||"bigNum"==b?'<div class="ui-grid-cell-'+a+' ui-grid-cell-contents" title="{{COL_FIELD}}">{{COL_FIELD | number:2}}</div>':'<div class="ui-grid-cell-'+a+' ui-grid-cell-contents" title="{{COL_FIELD}}">{{COL_FIELD}}</div>'}}}}),angular.module("superstockApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),angular.module("firebase.auth",[]).constant("SIMPLE_LOGIN_PROVIDERS",["password","facebook"]).constant("loginRedirectPath","/login").factory("auth",["$firebaseAuth",function(a){return a()}]),angular.module("firebase.ref",["firebase"]).factory("Ref",function(){return firebase.database().ref()}),angular.module("superstockApp").controller("LoginCtrl",["$scope","auth","$location",function(a,b,c){function d(a){var b=(rootRef.child("users").child(a.uid),$q.defer());return ref.set({email:email,name:e(email)},function(a){$timeout(function(){a?b.reject(a):b.resolve(ref)})}),b.promise}function e(a){return f(a.substr(0,a.indexOf("@"))||"")}function f(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function g(){c.path("/account")}function h(b){a.err=b}a.loginBtn=!0,a.logoutBtn=!0,b.$onAuthStateChanged(function(b){b&&(console.log(" logged: "+b.uid),a.logoutBtn=!0,a.loginBtn=!1,c.path("/account"))}),a.oauthLogin=function(a){b.$signInWithPopup(a).then(function(a){console.log("logged"),g()})["catch"](function(a){console.log("login error"),h(a)})},a.anonymousLogin=function(){b.$signInAnonymously().then(function(a){console.log("logged ",a.uid)})["catch"](function(a){console.log("login error ",a)})},a.passwordLogin=function(a,c){b.$signInWithEmailAndPassword(a,c).then(function(a){g(),console.log("logged")})["catch"](function(a){h(a),console.log("error: "+a)})},a.createAccount=function(c,e,f){a.err=null,e?e!==f?a.err="Passwords do not match":b.$createUserWithEmailAndPassword(c,e).then(function(a){return console.log("User "+a.uid+" created successfully"),a}).then(function(a){console.log("Logged user: ",a.uid),d(),g()})["catch"](function(a){console.error("Error: ",a)}):a.err="Please enter a password"}}]),angular.module("superstockApp").controller("AccountCtrl",["$scope","auth","currentAuth",function(a,b,c,d){function e(a){console.log("Error: ",a)}a.user={uid:c.uid,name:c.displayName,photo:c.photoURL,email:c.email},a.authInfo=c,a.changePassword=function(c,d,f){a.err=null,c&&d?d!==f?e("Passwords do not match"):b.$updatePassword(d).then(function(){console.log("Password changed")},e):e("Please enter all fields")},a.changeEmail=function(a){b.$updateEmail(a).then(function(){console.log("email changed successfully")})["catch"](function(a){console.log("Error: ",a)})},a.logout=function(){b.$signOut()},a.updateProfile=function(a,b){firebase.auth().currentUser.updateProfile({displayName:a,photoURL:b}).then(function(){console.log("updated")})["catch"](function(a){console.log("error ",a)})}}]),angular.module("superstockApp").controller("MainCtrl",["$rootScope","$scope","$firebaseArray","$firebaseObject","Ref","draw","utils","$window","$sce",function(a,b,c,d,e,f,g,h,i){a.link="main",h.ga("send","event","Page","Tổng hợp"),$("#wrapper").addClass("toggled");var j=parseFloat($(".header").css("height"))+parseFloat($(".footer").css("height")),k=$(window).height();$("#wrapper .view-containner").height(k-j),b.gridOptions={data:[]},console.log(b.gridOptions);var l=d(e.child("summary_titles")),m=d(e.child("summary_headers")),n=d(e.child("summary_format"));l.$loaded(function(){m.$loaded(function(){n.$loaded(function(){function a(){$(".ui-grid-header-cell").each(function(){var a=$(this),b=a.find("span");b.text().indexOf("\n")<0?(b.parent().css("line-height","40px"),a.css("text-align","center")):b.last().css("margin-top","-2px")})}var c=l.data.split("|"),d=m.data.split("|"),h=n.data.split("|");console.log(h),console.log(c),console.log(d);var j=[70,250,125,95,75,75,90,140,140,60,140],k=[],o={idLabel:"Mã",labelList:[]};for(var p in c){o.labelList.push({fieldName:d[p],format:h[p]});var q=null,r=null;h[p].indexOf("bigNum")>-1||h[p].indexOf("number")>-1?(q="number",r="ui-cell-align-right"):r=h[p].indexOf("percent")>-1?"ui-cell-align-right":"ui-cell-align-left";var s={field:d[p],displayName:c[p],cellClass:r,width:j[p],headerCellTemplate:"<div role=\"columnheader\" ng-class=\"{ 'sortable': sortable }\" ui-grid-one-bind-aria-labelledby-grid=\"col.uid + '-header-text ' + col.uid + '-sortdir-text'\" aria-sort=\"{{col.sort.direction == asc ? 'ascending' : ( col.sort.direction == desc ? 'descending' : (!col.sort.direction ? 'none' : 'other'))}}\"><div role=\"button\" tabindex=\"0\" class=\"ui-grid-cell-contents ui-grid-header-cell-primary-focus summary-header-"+d[p]+'" col-index="renderIndex" ng-class="{\'single-line\': col.displayName.indexOf(\'\n\') < 0}" title="TOOLTIP"><span class="ui-grid-header-cell-label" ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-one-bind-id-grid="col.uid + \'-sortdir-text\'" ui-grid-visible="col.sort.direction" aria-label="{{getSortDirectionAriaLabel()}}"><i ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }" title="{{isSortPriorityVisible() ? i18n.headerCell.priority + \' \' + ( col.sort.priority + 1 )  : null}}" aria-hidden="true"></i> <sub ui-grid-visible="isSortPriorityVisible()" class="ui-grid-sort-priority-number">{{col.sort.priority + 1}}</sub></span></div><div role="button" tabindex="0" ui-grid-one-bind-id-grid="col.uid + \'-menu-button\'" class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}" ui-grid-one-bind-aria-label="i18n.headerCell.aria.columnMenuButtonLabel" aria-haspopup="true"><i class="ui-grid-icon-angle-down" aria-hidden="true">&nbsp;</i></div><div ui-grid-filter></div></div>'};q&&(s.cellFilter=q),h[p].indexOf("percent")>-1&&(s.cellClass+=" percent"),s.cellTemplate=g.getCellTemplateSummary(d[p],h[p]),"symbol"==s.field&&(s.pinnedLeft=!0),"totalValue"==s.field&&(s.sort={direction:"desc",priority:0}),"industry"==s.field&&(s.minWidth=200),k.push(s)}b.gridOptions.columnDefs=k,f.drawGrid(e.child("summary_data"),o,function(a){b.gridOptions.data.push(a)},function(b){setTimeout(function(){a()},1e3)},{added:function(a,c,d){var e=c.key;for(var f in b.gridOptions.data)if(b.gridOptions.data[f].symbol==e)return void(b.gridOptions.data[f]=a);b.gridOptions.data.push(a)},changed:function(a,c,d){var e=c.key;for(var f in b.gridOptions.data)if(b.gridOptions.data[f].symbol==e){b.$apply(function(){for(var c in a)b.gridOptions.data[f][c]=a[c]});break}},removed:function(a){var c=a.key;for(var d in b.gridOptions.data)if(b.gridOptions.data[d].symbol==c){b.gridOptions.data.splice(d,1);break}}}),b.symbolClick=function(a,c){$("#myModal").modal("show"),b.stockInfo=a.entity.symbol+" - "+a.entity.industry,b.iSrc="https://banggia.vndirect.com.vn/chart/?symbol="+a.entity.symbol,b.iSrcTrust=i.trustAsResourceUrl(b.iSrc)},b.fillCanslim=function(a){return""!=a.entity.signal1||""!=a.entity.signal2?!0:!1},b.colorCanslim=function(a,b){return""!=a.entity.signal1||""!=a.entity.signal2?""!=a.entity.Canslim?"purple"==b?!0:!1:"green"==b?!0:!1:!1},b.showSymbolHasSignal=function(a,b){return""!=a.entity.signal1||""!=a.entity.signal2?b:""}})})})}]),angular.module("superstockApp").controller("FullStockCtrl",["$rootScope","$scope","auth","$firebaseArray","$firebaseObject","Ref","draw","uiGridConstants","$sce","utils","currentAuth","$window",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b){if(b){for(var c in b)for(var d in a)if(a[d].field==c){a[d].filters?a[d].filters[0].term=b[c]:a[d].filter&&(a[d].filter.term=b[c]);break}return a}b={};for(var c in a)a[c].filters?b[a[c].field]=a[c].filters[0]&&a[c].filters[0].term?a[c].filters[0].term:null:a[c].filter&&(b[a[c].field]=a[c].filter.term?a[c].filter.term:null);return b}a.link="full",l.ga("send","event","Page","Đầy đủ");var n=null,o=null;if(k){var p=e(f.child("users/"+k.uid+"/filter"));p.$loaded(function(a){o={};for(var c in a)"$"!=c.charAt(0)&&"forEach"!=c&&(o[c]=a[c]);b.gridOptions.columnDefs&&(b.gridOptions.columnDefs=m(b.gridOptions.columnDefs,o))})}$("#wrapper").addClass("toggled"),b.iSrc="",b.iSrcTrust=i.trustAsResourceUrl(b.iSrc),b.uiGridConstants=h;var q=parseFloat($(".header").css("height"))+parseFloat($(".footer").css("height")),r=$(window).height();$("#wrapper .view-containner").height(r-q),b.gridOptions={flatEntityAccess:!0,fastWatch:!0,enableFiltering:!0,data:[],onRegisterApi:function(a){b.gridApi=a,b.gridApi.core.on.filterChanged(b,function(){n=f.child("users/"+k.uid);var a=m(b.gridOptions.columnDefs,null);n.child("filter").set(a,function(a){a?console.log(a):console.log("Saved filter")})})}};var s=1e9,t=e(f.child("superstock_titles")),u=e(f.child("superstock_fields")),v=e(f.child("superstock_format"));u.$loaded(function(){t.$loaded(function(){v.$loaded(function(){var c=t.data.split("|"),d=u.data.split("|"),e=v.data.split("|"),h=[70,250,130,75,80,85,85,95,70,110,120,110,55,160,65,80,100,90,80,75,50,50,70,105,95,115,135,50,125,80,80,40,105,105,110,95,95,85,80,75,125,95,50,120],i=[],k={idLabel:"Mã",labelList:[]};for(var l in c){k.labelList.push({fieldName:d[l],format:e[l]});var n=null,p=null;e[l].indexOf("bigNum")>-1||e[l].indexOf("number")>-1?(n="number",p="ui-cell-align-right"):p=e[l].indexOf("percent")>-1?"ui-cell-align-right":"ui-cell-align-left";var q={field:d[l],width:h[l],displayName:c[l],cellClass:p,headerCellTemplate:'<div role="columnheader" ng-class="{ \'sortable\': sortable }" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'" aria-sort="{{col.sort.direction == asc ? \'ascending\' : ( col.sort.direction == desc ? \'descending\' : (!col.sort.direction ? \'none\' : \'other\'))}}"><div role="button" tabindex="0" class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" ng-class="{\'single-line\': col.displayName.indexOf(\'\n\') < 0}" title="TOOLTIP"><span class="ui-grid-header-cell-label" ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-one-bind-id-grid="col.uid + \'-sortdir-text\'" ui-grid-visible="col.sort.direction" aria-label="{{getSortDirectionAriaLabel()}}"><i ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }" title="{{isSortPriorityVisible() ? i18n.headerCell.priority + \' \' + ( col.sort.priority + 1 )  : null}}" aria-hidden="true"></i> <sub ui-grid-visible="isSortPriorityVisible()" class="ui-grid-sort-priority-number">{{col.sort.priority + 1}}</sub></span></div><div role="button" tabindex="0" ui-grid-one-bind-id-grid="col.uid + \'-menu-button\'" class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}" ui-grid-one-bind-aria-label="i18n.headerCell.aria.columnMenuButtonLabel" aria-haspopup="true"><i class="ui-grid-icon-angle-down" aria-hidden="true">&nbsp;</i></div><div ui-grid-filter></div></div>'};if(n&&(q.cellFilter=n),e[l].indexOf("percent")>-1&&(q.cellClass+=" percent"),""!=e[l]){var r=e[l].split(":");if(4===r.length){var w=[{condition:function(a,c){return!b.filterEnabled||c>=a},placeholder:"greater than",term:"bigNum"==r[0]?parseFloat(r[2])*s:parseFloat(r[2]),min:"bigNum"==r[0]?parseFloat(r[1])*s:parseFloat(r[1]),bigNum:"bigNum"==r[0]?!0:!1},{condition:function(a,c){return!b.filterEnabled||a>=c},placeholder:"less than",term:1/0,max:"bigNum"==r[0]?parseFloat(r[3])*s:parseFloat(r[3])}];q.filters=w,q.cellTemplate=j.getCellTemplate(d[l],n)}}else q.cellTemplate=j.getCellTemplate(d[l]);"shorttermSignal"==d[l]?q.filter={term:null,selectOptions:[{value:"xBán",label:"Bán"},{value:"xMua nếu cơ bản tốt",label:"Mua"}],condition:function(a,c){var d=[];for(var e in a)d.push(a[e].value);return d&&0!=a.length?!b.filterEnabled||d.indexOf(c)>-1:!0}}:"industry"==d[l]&&(q.filter={selectOptions:[{value:"Bao bì & đóng gói",label:"Bao bì & đóng gói"},{value:"Nông sản và thủy hải sản",label:"Nông sản và thủy hải sản"},{value:"Ngân hàng",label:"Ngân hàng"},{value:"Thực phẩm",label:"Thực phẩm"}],typeSearch:"multiple",term:null,condition:function(a,c){var d=[];for(var e in a)d.push(a[e].value);return d&&0!=a.length?!b.filterEnabled||d.indexOf(c)>-1:!0}}),i.push(q)}for(var l in i)"symbol"==i[l].field&&(i[l].pinnedLeft=!0,i[l].cellTemplate='<div><div class="ui-grid-cell-contents" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}                        <img class=\'chart-icon\' src=\'./images/icon-graph.png\' ng-click="grid.appScope.symbolClick(row,col)"/></div></div>');a.filters=i,b.gridOptions.columnDefs=i,console.log(i),o&&(b.gridOptions.columnDefs=m(b.gridOptions.columnDefs,o)),g.drawGrid(f.child("superstock"),k,function(a){b.gridOptions.data.push(a)},function(a){},{added:function(a,c,d){var e=c.key;for(var f in b.gridOptions.data)if(b.gridOptions.data[f].symbol==e)return void(b.gridOptions.data[f]=a);b.gridOptions.data.push(a)},changed:function(a,c,d){var e=c.key;for(var f in b.gridOptions.data)if(b.gridOptions.data[f].symbol==e){b.$apply(function(){for(var c in a)b.gridOptions.data[f][c]=a[c]});break}},removed:function(a){var c=a.key;for(var d in b.gridOptions.data)if(b.gridOptions.data[d].symbol==c){b.gridOptions.data.splice(d,1);break}}})})})}),a.parseBigNum=function(a){var b=parseFloat(a)/s;return b},b.symbolClick=function(a,c){$("#myModal").modal("show"),b.stockInfo=a.entity.symbol+" - "+a.entity.industry,b.iSrc="https://banggia.vndirect.com.vn/chart/?symbol="+a.entity.symbol,b.iSrcTrust=i.trustAsResourceUrl(b.iSrc)},a.onOffFilter=function(a){b.filterEnabled=a,setTimeout(function(){b.gridApi.core.notifyDataChange(h.dataChange.COLUMN)},500)},a.search=function(c){b.gridApi.grid.columns[0].filters[0]={term:a.searchTerm}},a.defaultFilter=function(a){if(a){a=a[0],l.ga("send","event","Filter",a.filterName);for(var c in b.gridOptions.columnDefs){var d=b.gridOptions.columnDefs[c].field;for(var e in a)if("filterName"!=e&&e==d){b.gridOptions.columnDefs[c].filters&&(b.gridOptions.columnDefs[c].filters[0].term=a[e]);break}}}},$(document).ready(function(){$(document).on("change",".subTerm",function(){var a=$(this);a.prop("value",a.val());var c=a.prop("id");for(var d in b.gridOptions.columnDefs)if(b.gridOptions.columnDefs[d].field==c){b.$apply(function(){b.gridOptions.columnDefs[d].filters[0].term=parseFloat(a.val())*s,a.prop("value",a.val())});break}a.parent().next().children().slider({slide:function(b,c){a.prop("value",c.value/s)}})}),$(document).click(function(b){var c=$("#sidebar-wrapper");if(!c.is(b.target)&&0===c.has(b.target).length){if(b.preventDefault(),b.stopPropagation(),"main"==a.link)return;if($("#wrapper").prop("class").indexOf("toggled")>-1)return;$("#wrapper").toggleClass("toggled")}})})}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("superstockApp").controller("MenuCtrl",["$rootScope","$scope","auth","$location","Ref","$firebaseObject",function(a,b,c,d,e,f){function g(){d.path("/")}a.user=null,a.link="",b.filterShow=function(b){b.preventDefault(),b.stopPropagation(),"main"!=a.link&&$("#wrapper").toggleClass("toggled")};b.oauthLogin=function(a){c.$signInWithPopup(a).then(function(a){g()})["catch"](function(a){console.log("login error"),console.log(a)})},b.logout=function(){c.$signOut(),d.path("/")},c.$onAuthStateChanged(function(a){})}]),angular.module("superstockApp").controller("FilterCtrl",["$rootScope","$scope","Ref","$firebaseArray","$compile",function(a,b,c,d,e){b.defaultFilter=[{EPS:1e3,maVol30:3e4,point:7,profitChange:20,roe:7,filterName:"Cơ bản tốt"}],b.$watch("filter",function(){if(a.defaultFilter)try{a.defaultFilter(b.filter)}catch(c){}}),b.$watch("filterEnabled",function(){a.onOffFilter&&a.onOffFilter(b.filterEnabled)})}]),angular.module("superstockApp").directive("ngShowAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("ngHideAuth",["auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuthStateChanged(e),e()}}}]),angular.module("superstockApp").directive("categoryHeader",function(){function a(a){console.log(a.gridOptions.columnDefs),a.headerRowHeight=30,a.catHeaderRowHeight=a.headerRowHeight+"px",a.categories=[];var b="",c=0,d=0;cols=a.gridOptions.columnDefs;for(var e=0;e<cols.length;e++){c+=Number(cols[e].width);var f="undefined"==typeof cols[e].categoryDisplayName?" ":cols[e].categoryDisplayName;f!==b&&(a.categories.push({displayName:b,width:c-Number(cols[e].width),widthPx:c-Number(cols[e].width)+"px",left:d,leftPx:d+"px"}),d+=c-Number(cols[e].width),c=Number(cols[e].width),b=f)}c>0&&a.categories.push({displayName:b,width:c,widthPx:c+"px",left:d,leftPx:d+"px"})}return{templateUrl:"scripts/directives/templates/category_header.html",link:a}}),angular.module("superstockApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/full",{templateUrl:"views/full-stock.html",controller:"FullStockCtrl",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl",resolve:{currentAuth:["auth",function(a){return a.$requireSignIn()}]}}).when("/chat",{templateUrl:"views/chat.html",controller:"Chat",resolve:{currentAuth:["auth",function(a){return a.$waitForSignIn()}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","loginRedirectPath","auth",function(a,b,c,d,e,f,g,h){d.$onAuthStateChanged(function(b){a.user=b}),a.$on("$routeChangeError",function(a,d,e,f){"AUTH_REQUIRED"===f&&b.path(c)})}]);